name: Publish Tagged Commits
descriptions: "This will fetch the publisher information and publish the new package version"
inputs:
  pub_cred:
    description: 'A secret value'
    required: true
runs:
  using: "composite"
  steps:
    - name: Run the publishing script to take the cred token from secrets and get rid of it afterwards.
      shell: bash
      run: |
          if [ "${{ job.status }}" != "success" ]; then exit 0; fi
          mkdir -p $HOME/.config/dart
          echo "${{ inputs.pub_cred }}" > $HOME/.config/dart/pub-credentials.json

          # flutter pub publish --dry-run
          flutter pub publish --force
          flutter pub logout


          rm -f ~/.config/dart/pub-credentials.json
          echo "pub_cred was cleared"
          echo "::add-mask::${{ inputs.pub_cred }}"